PASTE THIS EXACTLY INTO REPLIT ASSISTANT AS ONE TASK. DO EACH STEP IN ORDER. DO NOT SKIP OR REINTERPRET. WHEN A FILE ALREADY EXISTS, UPDATE IT IN PLACE. WHEN A DIRECTORY DOES NOT EXIST, CREATE IT.

Objective
Build the Super Admin portal end to end using Express on the server, Drizzle ORM with PostgreSQL for data, and React with Vite on the client. Add a safe fetch wrapper, fix the analytics fetch error, implement routes, controllers, and pages for Overview, Tenants, Sessions, Payments, Registrations, Parents, Players, Analytics, Help Requests, and Settings. Add server side pagination, shared filters, and minimal audit logging.

Project assumptions
TypeScript is enabled. Existing folders include server and src. You can install packages.

Install packages
Run the following in the project root

```
npm i zod @tanstack/react-query @tanstack/react-table recharts
npm i -D @types/express @types/node
```

Server structure
Create the following folders and files under server

```
server/
  routes/
    superAdmin.ts
  controllers/
    superAdmin/
      overview.ts
      tenants.ts
      sessions.ts
      payments.ts
      registrations.ts
      parents.ts
      players.ts
      analytics.ts
      help.ts
      settings.ts
  middleware/
    requireAuth.ts
    requireSuperAdmin.ts
  lib/
    pagination.ts
    validate.ts
```

Create middleware
`server/middleware/requireSuperAdmin.ts`

```ts
import { Request, Response, NextFunction } from 'express';
export function requireSuperAdmin(req: Request, res: Response, next: NextFunction) {
  if ((req as any).user?.role !== 'super_admin') {
    return res.status(403).json({ error: 'forbidden' });
  }
  next();
}
export default requireSuperAdmin;
```

`server/middleware/requireAuth.ts` if you already have one, keep using it. Otherwise add this minimal version now

```ts
import { Request, Response, NextFunction } from 'express';
export function requireAuth(req: Request, res: Response, next: NextFunction) {
  // replace with your real auth once wired, this is a harmless stub for local work
  if (!(req as any).user) {
    (req as any).user = { id: 'dev', role: 'super_admin' };
  }
  next();
}
export default requireAuth;
```

Create helpers
`server/lib/pagination.ts`

```ts
export function pageParams(q: any) {
  const page = Math.max(1, Number(q.page ?? 1));
  const pageSize = Math.min(200, Math.max(1, Number(q.pageSize ?? 25)));
  return { page, pageSize, offset: (page - 1) * pageSize };
}
export function wrapRows<T>(rows: T[], page: number, pageSize: number, totalRows: number) {
  return { rows, page, pageSize, totalRows };
}
```

`server/lib/validate.ts`

```ts
import { z } from 'zod';
export function parse<T extends z.ZodTypeAny>(schema: T, data: unknown) {
  const r = schema.safeParse(data);
  if (!r.success) {
    const issues = r.error.issues.map(i => `${i.path.join('.')}: ${i.message}`).join(', ');
    throw new Error(`validation failed: ${issues}`);
  }
  return r.data as z.infer<T>;
}
```

Create router and wire it
`server/routes/superAdmin.ts`

```ts
import { Router } from 'express';
import requireAuth from '../middleware/requireAuth';
import requireSuperAdmin from '../middleware/requireSuperAdmin';
import * as overview from '../controllers/superAdmin/overview';
import * as tenants from '../controllers/superAdmin/tenants';
import * as sessions from '../controllers/superAdmin/sessions';
import * as payments from '../controllers/superAdmin/payments';
import * as registrations from '../controllers/superAdmin/registrations';
import * as parents from '../controllers/superAdmin/parents';
import * as players from '../controllers/superAdmin/players';
import * as analytics from '../controllers/superAdmin/analytics';
import * as help from '../controllers/superAdmin/help';
import * as settings from '../controllers/superAdmin/settings';

const r = Router();
r.use(requireAuth, requireSuperAdmin);

r.get('/stats', overview.getStats);

r.get('/tenants', tenants.list);
r.post('/tenants', tenants.create);
r.patch('/tenants/:id', tenants.update);

r.get('/sessions', sessions.list);

r.get('/payments', payments.list);

r.get('/registrations', registrations.list);

r.get('/parents', parents.list);

r.get('/players', players.list);

r.get('/analytics/series', analytics.series);
r.get('/analytics/by-tenant', analytics.byTenant);

r.get('/help', help.list);
r.patch('/help/:id', help.update);

r.get('/settings', settings.get);
r.patch('/settings', settings.patch);

export default r;
```

Update `server/index.ts` to mount the router

```ts
import superAdminRoutes from './routes/superAdmin';
app.use('/api/super-admin', superAdminRoutes);
```

Controllers with shaped mock data that matches the current UI
Replace later with real Drizzle queries. Keep pagination shape for all list endpoints.

`server/controllers/superAdmin/overview.ts`

```ts
import { Request, Response } from 'express';
export async function getStats(req: Request, res: Response) {
  res.json({
    totals: {
      revenue: 450,
      players: 1250,
      activeTenants: 8,
      sessionsThisMonth: 340,
      pendingPayments: 12,
    },
    topTenants: [
      { id: 't1', name: 'Elite Footwork Academy', subdomain: 'elite-footwork', revenue: 320 },
      { id: 't2', name: 'Futsal Culture', subdomain: 'futsal-culture', revenue: 130 }
    ],
    recentActivity: [
      { id: 'a1', when: new Date().toISOString(), text: 'New tenant created Metro Futsal' },
      { id: 'a2', when: new Date().toISOString(), text: 'Payment processed 450 for Elite Academy' }
    ]
  });
}
```

`server/controllers/superAdmin/tenants.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 't1', organization: 'Elite Footwork Academy', subdomain: 'elite-footwork', contactEmail: 'admin@elitefootworkacademy.com', status: 'active', admins: 1, players: 33, sessions: 1, revenue: 30, created: '2025-07-28' },
    { id: 't2', organization: 'Futsal Culture', subdomain: 'futsal-culture', contactEmail: 'admin@futsal-culture.com', status: 'active', admins: 1, players: 37, sessions: 2, revenue: 20, created: '2025-07-28' },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
export async function create(req: Request, res: Response) {
  res.status(201).json({ id: 'newTenantId' });
}
export async function update(req: Request, res: Response) {
  res.json({ ok: true });
}
```

`server/controllers/superAdmin/sessions.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: '1', tenant: 'Futsal Culture', title: 'Morning Training Session', dateTime: '2025-07-28T09:00:00Z', location: 'Court A', ageGroup: 'U12', gender: 'Mixed', capacity: 16, price: 25, status: 'open' },
    { id: '2', tenant: 'Elite Footwork Academy', title: 'Elite Training', dateTime: '2025-07-28T18:00:00Z', location: 'Main Court', ageGroup: 'U16', gender: 'Boys', capacity: 12, price: 30, status: 'full' },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
```

`server/controllers/superAdmin/payments.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 'pi_1', tenant: 'Futsal Culture', player: 'Alex Johnson', parent: 'Sarah Johnson', session: 'Morning Training', amount: 25, method: 'stripe', status: 'completed', created: '2025-07-28T06:00:00Z' },
    { id: 'pi_2', tenant: 'Elite Footwork Academy', player: 'Emma Davis', parent: 'Michael Davis', session: 'Elite Training', amount: 30, method: 'venmo', status: 'pending', created: '2025-07-28T11:45:00Z' },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
```

`server/controllers/superAdmin/registrations.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 'r1', tenant: 'Futsal Culture', player: 'Alex Johnson', parent: 'Sarah Johnson', contact: 'sarah.johnson@email.com', session: 'Morning Training Session', sessionDate: '2025-07-29T09:00:00Z', registeredAt: '2025-07-27T06:30:00Z', status: 'confirmed', paymentStatus: 'paid', amount: 25 },
    { id: 'r2', tenant: 'Elite Footwork Academy', player: 'Emma Davis', parent: 'Michael Davis', contact: 'michael.davis@email.com', session: 'Elite Training', sessionDate: '2025-07-28T14:00:00Z', registeredAt: '2025-07-28T11:45:00Z', status: 'pending', paymentStatus: 'pending', amount: 30 },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
```

`server/controllers/superAdmin/parents.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 'p1', tenant: 'Elite Footwork Academy', name: 'William Lee', email: 'parent20@elitefootworkacademy.com', phone: '+12698523273', players: 0, totalBookings: 0, totalSpent: 0, lastActivity: '2025-07-28T14:33:00Z', status: 'active' },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
```

`server/controllers/superAdmin/players.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 'pl1', tenant: 'Futsal Culture', player: 'Harper Brind', ageGroup: 'U12', gender: 'Girls', parent: 'Atticus Brind', registeredAt: '2025-07-28T20:33:00Z', totalBookings: 0, portalAccess: 'disabled', bookingPermission: 'restricted', lastActivity: '2025-07-28T20:33:00Z' },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
```

`server/controllers/superAdmin/analytics.ts`

```ts
import { Request, Response } from 'express';
export async function series(req: Request, res: Response) {
  res.json({
    series: [
      { date: '2025-07-25', revenue: 100, signups: 4 },
      { date: '2025-07-26', revenue: 200, signups: 12 },
      { date: '2025-07-27', revenue: 150, signups: 8 },
    ]
  });
}
export async function byTenant(req: Request, res: Response) {
  res.json({
    rows: [
      { tenant: 'Elite Footwork Academy', revenue: 320, signups: 12 },
      { tenant: 'Futsal Culture', revenue: 130, signups: 9 }
    ]
  });
}
```

`server/controllers/superAdmin/help.ts`

```ts
import { Request, Response } from 'express';
import { pageParams, wrapRows } from '../../lib/pagination';
export async function list(req: Request, res: Response) {
  const { page, pageSize } = pageParams(req.query);
  const rows = [
    { id: 'h1', tenant: 'Futsal Culture', subject: 'Question from player portal', submitter: 'player', category: 'technical', priority: 'low', status: 'open', replies: 0, submitted: '2025-07-28T21:33:00Z', resolved: null },
  ];
  res.json(wrapRows(rows, page, pageSize, rows.length));
}
export async function update(req: Request, res: Response) {
  res.json({ ok: true });
}
```

`server/controllers/superAdmin/settings.ts`

```ts
import { Request, Response } from 'express';
export async function get(req: Request, res: Response) {
  res.json({
    autoApproveTenants: false,
    enableMfaByDefault: false,
    enableTenantSubdomains: false,
    requireTenantApproval: true,
    defaultBookingWindowHours: 0,
    maxTenantsPerAdmin: 10,
    defaultSessionCapacity: 16,
    maintenanceMode: false,
  });
}
export async function patch(req: Request, res: Response) {
  res.json({ ok: true });
}
```

Client code
Create the following files

```
src/lib/api.ts
src/components/super-admin/DataTable.tsx
src/routes/super-admin/Overview.tsx
src/routes/super-admin/Tenants.tsx
src/routes/super-admin/Sessions.tsx
src/routes/super-admin/Payments.tsx
src/routes/super-admin/Registrations.tsx
src/routes/super-admin/Parents.tsx
src/routes/super-admin/Players.tsx
src/routes/super-admin/Analytics.tsx
src/routes/super-admin/Help.tsx
src/routes/super-admin/Settings.tsx
```

Safe fetch wrapper and fix for analytics fetch error
`src/lib/api.ts`

```ts
export async function api<T>(url: string, init?: RequestInit): Promise<T> {
  const res = await fetch(url, {
    credentials: 'include',
    headers: { 'content-type': 'application/json' },
    ...init,
  });
  if (!res.ok) throw new Error(await res.text());
  return res.json();
}
export const get = <T>(url: string) => api<T>(url);
export const post = <T>(url: string, body: unknown) => api<T>(url, { method: 'POST', body: JSON.stringify(body) });
export const patch = <T>(url: string, body: unknown) => api<T>(url, { method: 'PATCH', body: JSON.stringify(body) });
```

Refactor any existing custom fetch utilities to call the wrapper above. This resolves the error where fetch was called with the arguments in the wrong order.

Reusable data table
`src/components/super-admin/DataTable.tsx`

```tsx
import React from 'react';
import { ColumnDef, flexRender, getCoreRowModel, useReactTable } from '@tanstack/react-table';

type TableProps<T> = {
  columns: ColumnDef<T, any>[];
  data: T[];
  page: number;
  pageSize: number;
  totalRows: number;
  onPageChange: (page: number) => void;
};

export default function DataTable<T>({ columns, data, page, pageSize, totalRows, onPageChange }: TableProps<T>) {
  const table = useReactTable({ data, columns, getCoreRowModel: getCoreRowModel() });
  const totalPages = Math.max(1, Math.ceil(totalRows / pageSize));
  return (
    <div className="w-full">
      <table className="min-w-full text-sm">
        <thead>
          {table.getHeaderGroups().map(hg => (
            <tr key={hg.id}>
              {hg.headers.map(h => (
                <th key={h.id} className="text-left py-2 px-3">
                  {h.isPlaceholder ? null : flexRender(h.column.columnDef.header, h.getContext())}
                </th>
              ))}
            </tr>
          ))}
        </thead>
        <tbody>
          {table.getRowModel().rows.map(r => (
            <tr key={r.id} className="border-t border-gray-700">
              {r.getVisibleCells().map(c => (
                <td key={c.id} className="py-2 px-3">
                  {flexRender(c.column.columnDef.cell, c.getContext())}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
      <div className="flex items-center gap-2 py-3">
        <button disabled={page <= 1} onClick={() => onPageChange(page - 1)} className="px-2 py-1 rounded bg-gray-800 disabled:opacity-50">Prev</button>
        <div>Page {page} of {totalPages}</div>
        <button disabled={page >= totalPages} onClick={() => onPageChange(page + 1)} className="px-2 py-1 rounded bg-gray-800 disabled:opacity-50">Next</button>
      </div>
    </div>
  );
}
```

Analytics hook and page
`src/routes/super-admin/Analytics.tsx`

```tsx
import React, { useMemo } from 'react';
import { useQuery } from '@tanstack/react-query';
import { get } from '@/lib/api';
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, CartesianGrid } from 'recharts';

export default function Analytics() {
  const from = useMemo(() => new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(), []);
  const to = useMemo(() => new Date().toISOString(), []);
  const q = useQuery({
    queryKey: ['analytics', 'series', from, to, 'day'],
    queryFn: () => get<{ series: { date: string, revenue: number, signups: number }[] }>(`/api/super-admin/analytics/series?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}&interval=day`)
  });
  const data = q.data?.series ?? [];
  return (
    <div className="p-4">
      <h1 className="text-xl mb-4">Analytics</h1>
      <div className="h-72 w-full">
        <ResponsiveContainer>
          <LineChart data={data} margin={{ top: 10, right: 20, bottom: 10, left: 0 }}>
            <CartesianGrid strokeDasharray="3 3" />
            <XAxis dataKey="date" />
            <YAxis yAxisId="left" />
            <Tooltip />
            <Line yAxisId="left" type="monotone" dataKey="revenue" strokeWidth={2} dot={false} />
            <Line yAxisId="left" type="monotone" dataKey="signups" strokeWidth={2} dot={false} />
          </LineChart>
        </ResponsiveContainer>
      </div>
    </div>
  );
}
```

Other pages can consume the list endpoints using React Query and the DataTable. Create minimal pages now that render rows from the mock controllers. Example for Payments follows. Repeat for Sessions, Registrations, Parents, Players.

`src/routes/super-admin/Payments.tsx`

```tsx
import React from 'react';
import { useQuery } from '@tanstack/react-query';
import { get } from '@/lib/api';
import DataTable from '@/components/super-admin/DataTable';
import { ColumnDef } from '@tanstack/react-table';

type Row = { id: string, tenant: string, player: string, parent: string, session: string, amount: number, method: string, status: string, created: string };

export default function Payments() {
  const { data } = useQuery({ queryKey: ['payments', 1], queryFn: () => get<{ rows: Row[], page: number, pageSize: number, totalRows: number }>(`/api/super-admin/payments?page=1&pageSize=25`) });
  const rows = data?.rows ?? [];
  const page = data?.page ?? 1;
  const pageSize = data?.pageSize ?? 25;
  const totalRows = data?.totalRows ?? rows.length;
  const columns: ColumnDef<Row>[] = [
    { header: 'Tenant', accessorKey: 'tenant' },
    { header: 'Player', accessorKey: 'player' },
    { header: 'Parent', accessorKey: 'parent' },
    { header: 'Session', accessorKey: 'session' },
    { header: 'Amount', accessorKey: 'amount' },
    { header: 'Method', accessorKey: 'method' },
    { header: 'Status', accessorKey: 'status' },
    { header: 'Date', accessorKey: 'created' },
  ];
  return (
    <div className="p-4">
      <h1 className="text-xl mb-4">Payments</h1>
      <DataTable columns={columns} data={rows} page={page} pageSize={pageSize} totalRows={totalRows} onPageChange={() => {}} />
    </div>
  );
}
```

Overview page to consume the stats endpoint
`src/routes/super-admin/Overview.tsx`

```tsx
import React from 'react';
import { useQuery } from '@tanstack/react-query';
import { get } from '@/lib/api';

export default function Overview() {
  const { data } = useQuery({ queryKey: ['stats'], queryFn: () => get<any>('/api/super-admin/stats') });
  const t = data?.totals ?? { revenue: 0, players: 0, activeTenants: 0, sessionsThisMonth: 0, pendingPayments: 0 };
  const top = data?.topTenants ?? [];
  const activity = data?.recentActivity ?? [];
  return (
    <div className="p-4 space-y-6">
      <div className="grid grid-cols-5 gap-4">
        <Card title="Total Revenue" value={`$${t.revenue.toFixed(2)}`} />
        <Card title="Total Players" value={t.players} />
        <Card title="Active Tenants" value={t.activeTenants} />
        <Card title="Total Sessions" value={t.sessionsThisMonth} />
        <Card title="Pending Payments" value={t.pendingPayments} intent="warning" />
      </div>
      <div className="grid grid-cols-2 gap-6">
        <div>
          <h2 className="text-lg mb-2">Top Performing Tenants</h2>
          <ul className="space-y-2">
            {top.map((x: any) => (
              <li key={x.id} className="flex items-center justify-between bg-gray-900 rounded px-3 py-2">
                <div className="truncate">{x.name}</div>
                <div>${x.revenue.toFixed(2)}</div>
              </li>
            ))}
          </ul>
        </div>
        <div>
          <h2 className="text-lg mb-2">Recent Platform Activity</h2>
          <ul className="space-y-2">
            {activity.map((a: any) => (
              <li key={a.id} className="bg-gray-900 rounded px-3 py-2">
                <div className="text-sm">{new Date(a.when).toLocaleString()}</div>
                <div>{a.text}</div>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  );
}

function Card({ title, value, intent }: { title: string, value: React.ReactNode, intent?: 'warning' | 'default' }) {
  return (
    <div className={`rounded-xl p-4 bg-gray-900 ${intent === 'warning' ? 'ring-2 ring-yellow-500' : ''}`}>
      <div className="text-sm opacity-70">{title}</div>
      <div className="text-2xl font-semibold mt-1">{value}</div>
    </div>
  );
}
```

Wire pages into your router or layout as needed.

Quality guardrails
One, every list endpoint must return the pagination shape used above. Two, all client list pages must request with page and pageSize and render via DataTable. Three, use encodeURIComponent for any date strings in query params. Four, after refactor there should be no direct calls to fetch anywhere other than api.ts. Five, record a simple audit line to console from each controller for now with the user id and action so you can later move this into a table.

Deliverables for this task
One, all server files created and mounted. Two, all client pages exist and render mock data without runtime errors. Three, the analytics overlay error is gone due to the safe fetch wrapper. Four, Overview page shows cards, top tenants, and recent activity from the stats endpoint.

When finished, run the dev server and confirm Overview, Tenants, Sessions, Payments, Registrations, Parents, Players, Analytics, Help Requests, and Settings all render with the mocked data and pagination shapes. Do not change styles beyond utility classes already present.
